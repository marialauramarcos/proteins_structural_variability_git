"0","# read site information of the reference protein"
"0","site.info = read.csv(site.info.fname, header = T, sep = "","")"
"0","m.min.da.CM.CA = read.csv(min.da.CM.CA.fname)"
"0","m.sum.inv.da.CM.CA = read.csv(sum.inv.da.CM.CA.fname)"
"0","# add info to site.info"
"0","d = ddply(site.info, ""site"", .fun = function(x) data.frame(""da"" = min(x[, c(-1, -2)])))"
"0","# define shells of active.sites site neighborhood"
"0","d$shell = cut(d$da, breaks = c(-.1, 2.5, 7.5, 12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5, 52.5, max(d$da)))"
"0","levels(d$shell) = seq(length(levels(d$shell))) - 1 # rename shell levels"
"0","site.info = merge(site.info, d, by = ""site"")"
"0","# read reference pdb and calculate resno, AA, and CN"
"0","reference.pdb.fname = file.path(data.dir,paste(reference, "".pdb"", sep = """"))"
"0","ref.pdb = read.pdb(reference.pdb.fname)"
"0","inds = atom.select(ref.pdb, elety = ""CA"")"
"0","ref.pdb.ca = ref.pdb$atom[inds$atom,]"
"0","cmap.ca = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)"
"0","CN = rowSums(cmap.ca, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!"
"0","n.sites = length(CN)"
"0","AA = ref.pdb.ca$resid"
"0","resno = ref.pdb.ca$resno"
"0","pdb.info = data.frame(resno, AA, CN)"
"0","names(pdb.info) = c(""resno"", ""AA"", paste(""CN"", as.character(R0), sep = """"))"
"0","# add pdb.info to site.info"
"0","site.info = cbind(site.info, pdb.info)"

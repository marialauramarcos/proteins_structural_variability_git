
```{r setup, include = FALSE}
# set chunk options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

# Introduction
In this report we compare experimental and theoretical SDi profiles and SDi profiles with MSFi and 1/CN. We show the figures of all families.
Then, we compare correlations between SDi profiles with the number of proteins of the family and the sites of p.ref. Finally, we comapre correlations obtained for SDi theo profiles with correlations obtained for LPD. 

```{r load-packages}
# load packages
library(png)
```

```{r read-input}
# read input
input.fname <- "input_MainReport.csv"
input <- read.csv(input.fname)
```

## exp SDi vs theo SDi
```{r plot-sqrt-SDi, fig.height=20}
  layout(matrix(1:24, 8, 3, byrow = T))

  # satart a loop for each family
for (f in (1:nrow(input))) { 
  family <- as.character(input$family)[f]
  p.ref <- as.character(input$p.ref)[f]

  d = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "d.SD.csv", sep = "")))

  # get subsets
  d.exp = subset(d, dataset == "exp")
  d.mut = subset(d, dataset == "no-selection")
  d.medium = subset(d, dataset == "selection")

 # calculate Pearson correlation
  r.exp.mut = cor(sqrt(d.exp$mean.SD), sqrt(d.mut$mean.SD))
  r.exp.medium = cor(sqrt(d.exp$mean.SD), sqrt(d.medium$mean.SD))
  r.mut.medium = cor(sqrt(d.mut$mean.SD), sqrt(d.medium$mean.SD))

  ## plot exp vs simulated sqrt SDi profiles
  par(pty = "s")

  plot(x = scale(sqrt(d.mut$mean.SD)), 
       y = scale(sqrt(d.exp$mean.SD)), 
       xlab = "sqrt <SDi> no-selection", 
       ylab = "sqrt <SDi> experimental") 
  lm = lm(sqrt(d.exp$mean.SD) ~ sqrt(d.mut$mean.SD))
  legend("topleft", paste ("r = ", round(r.exp.mut, digits = 2)), bty = "n")

  plot(x = scale(sqrt(d.medium$mean.SD)), 
       y = scale(sqrt(d.exp$mean.SD)), 
       xlab = "sqrt <SDi> selection", 
       ylab = "sqrt <SDi> experimental",
       main = family) 
  lm = lm(sqrt(d.exp$mean.SD) ~ sqrt(d.medium$mean.SD)) 
  legend("topleft", paste ("r = ", round(r.exp.medium, digits = 2)), bty = "n")

  plot(x = scale(sqrt(d.mut$mean.SD)), 
       y = scale(sqrt(d.medium$mean.SD)), 
       xlab = "sqrt <SDi> no-selection", 
       ylab = "sqrt <SDi> selection")
  lm = lm(sqrt(d.medium$mean.SD) ~ sqrt(d.mut$mean.SD))
  legend("topleft", paste ("r = ", round(r.mut.medium, digits = 2)), bty = "n")
}
```

## SDi vs MSF
```{r plot-sqrt-SDi-MSF, fig.height=20}
  layout(matrix(1:24, 8, 3, byrow = T))

  # satart a loop for each family
for (f in (1:nrow(input))) { 
  family <- as.character(input$family)[f]
  p.ref <- as.character(input$p.ref)[f]

  d = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "d.SD.csv", sep = "")))
  MSF.p.ref = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "MSF.csv", sep = "")))[, 2]

  # extract means
  d.exp = subset(d, dataset == "exp")
  d.mut = subset(d, dataset == "no-selection")
  d.medium = subset(d, dataset == "selection")

  ## correlations
  r.exp = cor(sqrt(d.exp$mean.SD), sqrt(MSF.p.ref))
  r.medium = cor(sqrt(d.medium$mean.SD), sqrt(MSF.p.ref))
  r.mut = cor(sqrt(d.mut$mean.SD), sqrt(MSF.p.ref))

  ## plots
  par(pty = "s")

  plot(y = (sqrt(d.exp$mean.SD)), x = sqrt(MSF.p.ref), ylab = "sqrt <SDi> experimental", xlab = "sqrt MSFi")
  lm = lm((sqrt(d.exp$mean.SD)) ~ sqrt(MSF.p.ref))
  legend("topleft", paste ("r = ", round(r.exp, digits = 2)), bty = "n")

  plot(y = (sqrt(d.mut$mean.SD)), x = sqrt(MSF.p.ref), ylab = "sqrt <SDi> no-selection", xlab = "sqrt MSFi", main = family) 
  lm = lm((d.mut$mean.SD) ~ MSF.p.ref)
  legend("topleft", paste ("r = ", round(r.mut, digits = 2)), bty = "n")

  plot(y = (sqrt(d.medium$mean.SD)), x = sqrt(MSF.p.ref), ylab = "sqrt <SDi> selection", xlab =   "sqrt MSFi")
  lm = lm(d.medium$mean.SD ~ MSF.p.ref)
 legend("topleft", paste ("r = ", round(r.medium, digits = 2)), bty = "n")
}
```

## SDi vs LPD
```{r plot-sqrt-SDi-LPD, fig.height=20}

  layout(matrix(1:24, 8, 3, byrow = T))

  # satart a loop for each family
for (f in (1:nrow(input))) { 
  family <- as.character(input$family)[f]
  p.ref <- as.character(input$p.ref)[f]

  # select ENM
  if (enm = "ANM") {LPD = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "CN.csv", sep = "")))[, 2]}
  if (enm = "pfANM") {LPD = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "WCN.csv", sep = "")))[, 2]}
  
  d = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "d.SD.csv", sep = "")))

  # extract means
  d.exp = subset(d, dataset == "exp")
  d.mut = subset(d, dataset == "no-selection")
  d.medium = subset(d, dataset == "selection")

  ## correlations
  r.exp = cor(sqrt(d.exp$mean.SD), sqrt(1/LPD))
  r.medium = cor(sqrt(d.medium$mean.SD), sqrt(1/LPD))
  r.mut = cor(sqrt(d.mut$mean.SD), sqrt(1/LPD))

  ## plots
  par(pty = "s")

  plot(y = (sqrt(d.exp$mean.SD)), x = sqrt(1/LPD), ylab = "sqrt <SDi> experimental", xlab = "sqrt 1/LPDi")
  lm = lm((sqrt(d.exp$mean.SD)) ~ sqrt(1/LPD))
  legend("topleft", paste ("r = ", round(r.exp, digits = 2)), bty = "n")

  plot(y = (sqrt(d.mut$mean.SD)), x = sqrt(1/LPD), ylab = "sqrt <SDi> no-selection", xlab = "sqrt 1/LPDi", main = family) 
  lm = lm((d.mut$mean.SD) ~ 1/LPD)
  legend("topleft", paste ("r = ", round(r.mut, digits = 2)), bty = "n")

  plot(y = (sqrt(d.medium$mean.SD)), x = sqrt(1/LPD), ylab = "sqrt <SDi> selection", xlab =   "sqrt 1/LPDi")
  lm = lm(d.medium$mean.SD ~ 1/LPD)
 legend("topleft", paste ("r = ", round(r.medium, digits = 2)), bty = "n")
}
```

## (exp SDi vs theo SDi) vs  n.sites or n.prot
```{r plot-sqrt-SDi-n.sites-n.prot, fig.height=7, fig.width=7}

v.r.exp.mut = c()
v.r.exp.medium = c()
v.r.mut.medium = c()

v.n.sites = c()
v.n.prot = c()

  # satart a loop for each family
for (f in (1:nrow(input))) { 
  family <- as.character(input$family)[f]
  p.ref <- as.character(input$p.ref)[f]

  d = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "d.SD.csv", sep = "")))
  protein_list = read.csv(file.path(data.dir, paste(family, "_list.txt", sep = "")))
  n.prot = nrow(protein_list)
  n.sites = nrow(subset(d, dataset == "exp"))
  
  v.n.prot = c(v.n.prot, n.prot)
  v.n.sites = c(v.n.sites, n.sites)

  # get subsets
  d.exp = subset(d, dataset == "exp")
  d.mut = subset(d, dataset == "no-selection")
  d.medium = subset(d, dataset == "selection")

 # calculate Pearson correlation
  r.exp.mut = cor(sqrt(d.exp$mean.SD), sqrt(d.mut$mean.SD))
  r.exp.medium = cor(sqrt(d.exp$mean.SD), sqrt(d.medium$mean.SD))
  r.mut.medium = cor(sqrt(d.mut$mean.SD), sqrt(d.medium$mean.SD))

  v.r.exp.mut = c(v.r.exp.mut, r.exp.mut)
  v.r.exp.medium = c(v.r.exp.medium, r.exp.medium)
  v.r.mut.medium = c(v.r.mut.medium, r.mut.medium)
}

layout(matrix(1:6, 2, 3, byrow = T))

plot(y = v.r.exp.mut, x = v.n.prot, ylab = "r (sqrt SDi exp, sqrt SDi no-selection)", xlab = "n exp prot", xlim = c(10, 50))
text(y = v.r.exp.mut, x = v.n.prot, input$family, cex=0.6, pos=4, col="black")
plot(y = v.r.exp.medium, x = v.n.prot, ylab = "r (sqrt SDi exp, sqrt SDi selection)", xlab = "n exp prot", xlim = c(10, 50))
text(y = v.r.exp.medium, x = v.n.prot, input$family, cex=0.6, pos=4, col="black")
plot(y = v.r.mut.medium, x = v.n.prot, ylab = "r (sqrt SDi no-selection, sqrt SDi selection)", xlab = "n exp prot", xlim = c(10, 50))
text(y = v.r.mut.medium, x = v.n.prot, input$family, cex=0.6, pos=4, col="black")

plot(y = v.r.exp.mut, x = v.n.sites, ylab = "r (sqrt SDi exp, sqrt SDi no-selection)", xlab = "n sites p.ref", xlim = c(50, 250))
text(y = v.r.exp.mut, x = v.n.sites, input$family, cex=0.6, pos=4, col="black")
plot(y = v.r.exp.medium, x = v.n.sites, ylab = "r (sqrt SDi exp, sqrt SDi selection)", xlab = "n sites p.ref", xlim = c(50, 250))
text(y = v.r.exp.medium, x = v.n.sites, input$family, cex=0.6, pos=4, col="black")
plot(y = v.r.mut.medium, x = v.n.sites, ylab = "r (sqrt SDi no-selection, sqrt SDi selection)", xlab = "n sites p.ref", xlim = c(50, 250))
text(y = v.r.mut.medium, x = v.n.sites, input$family, cex=0.6, pos=4, col="black")

layout(matrix(1:1, 1, 1, byrow = T))
plot(y = v.n.sites, x = v.n.prot, ylab = "n sites p.ref", xlab = "n exp prot", xlim = c(10, 50))
text(y = v.n.sites, x = v.n.prot, input$family, cex=0.6, pos=4, col="black")
```

## (exp SDi vs theo SDi) vs  (exp SDi vs LPD)
```{r comparison-LPD-SDi, fig.height=6, fig.width=12}

v.r.exp.mut = c()
v.r.exp.medium = c()
v.r.mut.medium = c()

cor.p.sqrt = c()

  # satart a loop for each family
for (f in (1:nrow(input))) { 
  family <- as.character(input$family)[f]
  p.ref <- as.character(input$p.ref)[f]

  d = read.csv(file.path(data.dir, paste(family, "_", p.ref, "_R0_", R0, "d.SD.csv", sep = "")))
  protein_list = read.csv(file.path(data.dir, paste(family, "_list.txt", sep = "")))
  n.prot = nrow(protein_list)
  n.sites = nrow(subset(d, dataset == "exp"))
  
  v.n.prot = c(v.n.prot, n.prot)
  v.n.sites = c(v.n.sites, n.sites)

  # get subsets
  d.exp = subset(d, dataset == "exp")
  d.mut = subset(d, dataset == "no-selection")
  d.medium = subset(d, dataset == "selection")

 # calculate Pearson correlation
  r.exp.mut = cor(sqrt(d.exp$mean.SD), sqrt(d.mut$mean.SD))
  r.exp.medium = cor(sqrt(d.exp$mean.SD), sqrt(d.medium$mean.SD))
  r.mut.medium = cor(sqrt(d.mut$mean.SD), sqrt(d.medium$mean.SD))

  v.r.exp.mut = c(v.r.exp.mut, r.exp.mut)
  v.r.exp.medium = c(v.r.exp.medium, r.exp.medium)
  v.r.mut.medium = c(v.r.mut.medium, r.mut.medium)
  
  # read the data frame
  cc = read.csv(file = file.path("CORRELATIONS", paste(family, "_out_cc_R0s.csv", sep = "")))
  
  # get CA and CM pearson sqrt cc for f
  if (data.dir == "OUT/out_subset_CA_ANM") {cor.p.sqrt = c(cor.p.sqrt, cc$CA.pearson.sqrt[4])}
  if (data.dir == "OUT/out_subset_CM_ANM") {cor.p.sqrt = c(cor.p.sqrt, cc$CM.pearson.sqrt[4])}
  if (data.dir == "OUT/out_subset_CA_pfANM") {cor.p.sqrt = c(cor.p.sqrt, cc$CA.pearson.sqrt[13])}
  if (data.dir == "OUT/out_subset_CM_pfANM") {cor.p.sqrt = c(cor.p.sqrt, cc$CM.pearson.sqrt[13])}
}

layout(matrix(1:2, 1, 2, byrow = T))

par(pty = "s")
 
plot(y = v.r.exp.mut, x = cor.p.sqrt, ylab = "r (sqrt SDi exp, sqrt SDi no-selection)", xlab = "r (sqrt SDi exp, sqrt 1/LPD)", xlim = c(0.5, 1), ylim = c(0.5, 1))
text(y = v.r.exp.mut, x = cor.p.sqrt, input$family, cex=0.6, pos=4, col="black")
abline(0,1)
legend("topleft", paste ("r = ", round(cor(y = v.r.exp.mut, x = cor.p.sqrt), digits = 2)), bty = "n")

plot(y = v.r.exp.medium, x = cor.p.sqrt, ylab = "r (sqrt SDi exp, sqrt SDi selection)", xlab = "r (sqrt SDi exp, sqrt 1/LPD)", xlim = c(0.5, 1), ylim = c(0.5, 1))
text(y = v.r.exp.medium, x = cor.p.sqrt, input$family, cex=0.6, pos=4, col="black")
abline(0,1)
legend("topleft", paste ("r = ", round(cor(y = v.r.exp.medium, x = cor.p.sqrt), digits = 2)), bty = "n")

```